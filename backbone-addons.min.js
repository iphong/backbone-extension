void function(t,e,i,n){var s,r,o,h,c,d,l=t.B={},u=n.Model,f=n.Collection,p=n.View;n.Model.prototype.get;var g=n.Model.prototype.set;n.Collection.prototype.set;var b=p.prototype._ensureElement,v=e("<div>");i.mixin({isChildPrototypeOf:function(t,e){if(!t||!e)return!1;for(var i=!1,n=t.prototype;n;){if(n==e.prototype){i=!0;break}n=n.__proto__}return i}}),o=l.Computed=function(){function t(e,n){if(0==this instanceof t)return new t(e,n);if(i.isArray(e)||(n=e,e=[]),i.isFunction(n)&&(n={deps:e,get:n}),!n)throw"Computed value requires at least a get function.";i.extend(this,n),i.defaults(this,{deps:[],get:i.noop,set:i.noop})}return i.extend(t.prototype,n.Events),t}(),s=l.Model=function(){function t(e,n){if(this instanceof t==!1){var s={},o={};return e&&i.each(e,function(e,n){i(e).isChildPrototypeOf(t)?(s[n]={},o[n]=e):i(e).isChildPrototypeOf(r)?(s[n]=[],o[n]=e):s[n]=e}),t.extend({constructor:function(){t.apply(this,arguments)},defaults:s,relations:o})}var a,n=n||{},e=e||{};for(var h in e)(e[h]instanceof u||e[h]instanceof f)&&(e[h].parent=this);var c=!1;Object.defineProperty(this,"_relatedKey",{get:function(){if(c)return c;if(this.parent&&this.parent.attributes)for(var t in this.parent.attributes)if(this.parent.attributes[t]===this)return c=t}}),this.on("change",function(t,e){if(a=this.parent){t.parent.changed={};for(var i in t.changed)t.parent.changed[t._relatedKey+"."+i]=t.changed[i],t.parent.trigger("change:"+t._relatedKey+"."+i,t.parent,t.changed[i],e);t.parent.changed[t._relatedKey]=t,t.parent.trigger("change:"+t._relatedKey,t.parent,t,e),t.parent.trigger("change",t.parent,e)}}),u.call(this,e,n),("string"==typeof e||"number"==typeof data)&&(this.set("id",data),this.url()&&this.fetch())}var e=/^([0-9a-zA-Z_$]+)(\[([0-9]+)?\])?$/;return i.extend(t.prototype,{constructor:t,get:function(t){if(!t.match(/[.\[]/)){var i=this.attributes[t];return i instanceof o&&(i=i.get.call(this)),i}for(var s,r,a,h=t.split("."),c=this;h.length;){if(m=e.exec(h.shift()),a=m[1],s=m[2],r=m[3],!a)throw"Invalid object attribute key";if(!c)return void 0;c=c instanceof n.Model?c.get(a):c[a],s&&(c=c instanceof n.Collection?c.at(parseInt(r)):c[parseInt(r)])}return c},set:function(t,s,r){if(i.isObject(t))return r=s,i.each(t,function(t,e){this.set(e,t,r)},this)&&this;if(!t.match(/[.\[]/)){var a=this.get(t);return a instanceof o?a.set.call(this,s,r):g.call(this,t,s,r)}for(var h,c,d,l,u=t.split("."),f=this;f&&u.length;){if(c=e.exec(u.shift()),l=c[1],h=c[2],d=c[3],!l)throw"Invalid object attribute key";u.length&&(f=f instanceof n.Model?f.get(l):f[l],d&&(f=f instanceof n.Collection?f.at(parseInt(d)):f[parseInt(d)])),u.length||(h?d?(f=f instanceof n.Model?f.get(l):f[l],f instanceof n.Collection?f.at(d).set(s,r):f[d]=s):console.warn('Can not set "'+t+'"',s):f instanceof n.Model?f.set(l,s,r):f instanceof n.Collection?f.set(l,s,r):f instanceof Object&&(f[l]=s))}return this},clear:function(t){var e={};for(var s in this.attributes)this.attributes[s]instanceof n.Model?this.attributes[s].clear(t):this.attributes[s]instanceof n.Collection?(this.attributes[s].invoke("clear",t),this.attributes[s].reset([])):e[s]=void 0;return this.set(e,i.extend({},t,{unset:!0}))}}),Object.setPrototypeOf(t.prototype,u.prototype),t.extend=u.extend,t.extend=i.compose(u.extend,function(t){var t=t||{},e=t.defaults;for(var n in e)i(e[n]).isChildPrototypeOf(u)&&(t.relations||t.relations=={},t.relations[n]=e[n],e[n]={}),i(e[n]).isChildPrototypeOf(f)&&(t.relations||t.relations=={},t.relations[n]=e[n],e[n]=[]);return t}),t}(),r=l.Collection=function(){function t(e,n){if(this instanceof t==!1)return t.extend({model:i.isArray(e)?e[0]:e});var s,n=n||{},r=!1;Object.defineProperty(this,"_relatedKey",{get:function(){if(r)return r;if(s&&s.attributes)for(var t in s.attributes)if(s.attributes[t]===this)return r=t}}),this.on("change",function(t,e){if(s=this.parent){if(s.changed={},t&&t.collection){var i=t.collection.indexOf(t);for(var n in t.changed)s.changed[this._relatedKey+"["+i+"]."+n]=t.changed[n],s.trigger("change:"+this._relatedKey+"["+i+"]."+n,s,t.changed[n],e),s.changed[this._relatedKey+"."+n]=t.changed[n],s.trigger("change:"+this._relatedKey+"."+n,s,t.changed[n],e);s.changed[this._relatedKey]=this,s.trigger("change:"+this._relatedKey,s,e)}s.trigger("change",s,e)}}),f.apply(this,arguments)}return i.extend(t.prototype,{comparator:function(t){return t.get("index")}}),Object.setPrototypeOf(t.prototype,f.prototype),t.extend=f.extend,t}(),h=l.View=function(){function t(n){if(!(this instanceof t))return new t(n);var n=n||{};if(this.__ready=i.once(this.__ready),this.subViews=[],i.extend(this,i.pick(n,"template","views","bindings","events","modelEvents","superView")),this.template)switch(typeof this.template){case"string":this.template=this.template.match("<")?this.template.trim():e(this.template).html()}p.call(this,n),this.el&&this.el.parentNode&&this.__ready()}return i.extend(t.prototype,{bindings:!1,initialize:i.noop,ready:i.noop,_ensureElement:function(){b.call(this),this.render(),this.initSubViews()},setModel:function(t){t&&(this.modelEvents&&i(this.modelEvents).each(function(e,n){n=i(["event","selector"]).object(i(n.match(/(.*)\s(.*)/)||[0,n]).rest(1)),e=i.isString(e)?this[e]:e,this.model&&this.stopListening(n.selector?this.model.get(n.selector):this.model,n.event),this.listenTo(n.selector?t.get(n.selector):t,n.event,e)},this),this.model=t)},setBindingModel:function(t){return!this.__dataBinding&&console.warn("Data-binding hasn't been initialized for this view."),this.__dataBinding&&this.__dataBinding.setModel(t),this},__ready:function(){this.setModel(this.model),this.__dataBinding=new d(this,this.model,{bindings:i.result(this,"bindings")||[]}),this.ready()},freeze:function(){return this._frozen=!0,this.trigger("freeze"),this},unfreeze:function(){return this._frozen=!1,this.trigger("unfreeze"),this},preventDefault:function(t){t.preventDefault()},stopPropagation:function(t){t.stopPropagation()},defer:function(t,e){return i.defer(i.bind(t,e||this)),this},delay:function(t,e,n){return i.delay(i.bind(t,n||this),e),this},render:function(){return this.__render.apply(this,arguments)},__render:function(){return this.trigger("before:render"),this.template&&this.$el.html(this.template),this.trigger("render"),this},initSubViews:function(){var t=/^(\w+)(?: (collection|model):(\w+))?\s*>\s*(.*)$/;i.each(this.views,function(e,i){var n=i.match(t);if(!n)throw"View definition syntax error: '"+i+"'";var s=n[1],r=n[2],o=n[3],a=n[4],h={};r&&o&&(h[r]=this.model.get(o)),this[s]=this.attachView(e,a,h)},this)},hasView:function(t){return this.subViews&&this.subViews.indexOf(t)>-1},attachView:function(t,e,n){var s=this.$(e).get(0);if(!s)throw'No element found for selector "'+e+'"';return i.isFunction(t)?(n||(n={}),n.el=s,n.superView=this,t=new t(n)):(t.setElement(s),t.superView=this,this.hasView(t)||this.subViews.push(t)),t.__ready(),t},appendView:function(t){return this.hasView(t)||this.subViews.push(t),t.superView=this,t.$el.appendTo(this.el),t.__ready(),t},prependView:function(t){return this.hasView(t)||this.subViews.push(t),t.superView=this,t.$el.prependTo(this.el),t.__ready(),t},remove:function(){return this.trigger("before:remove"),p.prototype.remove.call(this),this.superView&&this.superView.subViews&&i(this.superView.subViews).each(function(t,e){t&&t.cid==this.cid&&this.superView.subViews.splice(e,1)},this),this.trigger("remove"),this}}),Object.setPrototypeOf(t.prototype,p.prototype),t.extend=p.extend,t}(),c=l.CollectionView=function(){function t(e){return this instanceof t?(this.previousSubViews={},this.options=e||{},this._debounceReset=i.debounce(this.reset),e.collection||(e.collection=new n.Collection),h.call(this,e),void 0):new t(e)}return i.extend(t.prototype,{itemView:h,_reverseOrder:!1,__ready:function(){this.__render(),this.getItemTemplate(),this.setCollection(this.collection),this.reset(),this.ready()},getItemTemplate:function(){var t=this.el.children[0];if(t){var e=t.innerHTML.trim();this.itemView.prototype==h.prototype&&(this.itemView=this.itemView.extend()),i.extend(this.itemView.prototype,{template:e,tagName:t.tagName,className:t.className,attributes:i(t.attributes).chain().values().map(function(t){return t.name}).object([]).mapObject(function(e,i){return t.getAttribute(i)}).value()})}this.$el.empty()},setCollection:function(t){t&&(t!==this.collection&&(this.collection=t),this.stopListening(this.collection,"add",this.add),this.stopListening(this.collection,"reset",this._debounceReset),this.stopListening(this.collection,"sort",this._debounceReset),this.listenTo(this.collection,"add",this.add),this.listenTo(this.collection,"reset",this._debounceReset),this.listenTo(this.collection,"sort",this._debounceReset),this.reset())},add:function(t){if(this.previousSubViews[t.cid]){var e=this.previousSubViews[t.cid];delete this.previousSubViews[t.cid]}else var e=new this.itemView({model:t});return e.mid=t.cid,this._reverseOrder?this.prependView(e):this.appendView(e),e},reset:function(){for(;this.subViews.length;){var t=this.subViews.pop();this.previousSubViews[t.mid]=t}this.collection.each(this.add,this);for(var e in this.previousSubViews)this.previousSubViews[e].$el.appendTo(v);return this}}),Object.setPrototypeOf(t.prototype,h.prototype),t.extend=h.extend,t}(),d=l.DataBind=function(){function t(e,n,s){return this instanceof t==!1?new t(e,n,s):(s||(s={}),this.options=i(s).defaults({bindings:[]}),this.view=null,this.models=[],this.bindings=[],i.bindAll(this,"inputEventHandler","changeEventHandler","modelChangeHandler"),this.setupView(e),this.setModel(n),this)}var s=/(?:(\w+):)?({.*}|[^;]+);?/gi;return parseb=function r(t){for(var e,i=/\s*(\w+)\s*:\s*([^,{]+(?!\()|\{(.+)\},(?=\s*\w)|\w+\(.+\)),?/g,n=Object.create(null,{}),t=t.replace(/\s+/," ").replace(/(.*)\}$/,"$1},a");e=i.exec(t);){var s=e[1],o=e[2],a=e[3];a&&(o=r(a)),n[s]=o}return n},t.prototype.__proto__=n.Events,i.extend(t.prototype,{setModel:function(t){return i(this.models).each(function(t){this.stopListening(t)},this),this.models=i.filter(i.isArray(t)?t:[t],function(t){return t instanceof n.Model}),i(this.models).each(function(t){this.listenTo(t,"change",this.modelChangeHandler)},this),this.updateView(),this},setupView:function(t){function r(n){for(d=e(n),l=(d.data("bind")||"").replace(/\s+/g,""),s.lastIndex=0,d.removeAttr("data-bind");g=s.exec(l);)if(u=g[1],f=g[2],u||(u=d.is('input[type="checkbox"],input[type="radio"]')?"checked":d.is("input,select,textarea")?"value":d.is("[contenteditable]")?"html":"text"),"collection"!=u)b=f.match(/{(.*)}/),f=b?b[1]:f,i(b?b[1].split(","):[f]).each(function(t){p=t.split(":"),o={$el:d,el:n,type:u,attr:1==p.length?p[0]:p[1]},2==p.length&&(o.key=p[0]),d.data("bind-events")&&(o.events=d.data("bind-events")),m.bindings.push(o),v=[o.attr],i(v).each(function(t){m.bindingsIndex[t]||(m.bindingsIndex[t]=[]),-1==m.bindingsIndex[t].indexOf(o)&&m.bindingsIndex[t].push(o)})});else{var r=a=t.model.get(f);new c({el:n,template:n.innerHTML,collection:r}),r.trigger("reset"),n.innerHTML=""}}if(0==t instanceof n.View)return!1;i(this.bindings).each(function(t){t.$el.off(t.events||"change",this.changeEventHandler)},this);var o,h,d,l,u,f,p,g,b,v,m=this;this.view=t,this.bindings=[],this.bindingsIndex={},i(this.options.bindings).each(function(n){h=t.$(n.selector),(h.length?h:t.$el).each(function(t,s){i(i.isString(n.attr)?[n.attr]:n.attr).each(function(t,r){o=i({$el:e(s),el:s,type:n.type,attr:t}).defaults(n),i.isString(r)&&(o.key=r),m.bindings.push(o),v=[o.attr],i(v).each(function(t){m.bindingsIndex[t]||(m.bindingsIndex[t]=[]),-1==m.bindingsIndex[t].indexOf(o)&&m.bindingsIndex[t].push(o)})})})});var y;for(t.$el.attr("data-bind")&&r(t.el);y=t.el.querySelector("[data-bind]");)r(y);i(this.bindings).each(function(t){t.$el.on(t.events||"change",{binding:t},this.changeEventHandler),t.$el.removeAttr("data-bind").removeAttr("data-bind-events")},this)},updateView:function(t,e){e||(e={});var s,r;i(t?this.bindingsIndex[t]:this.bindings).each(function(t){s=this.getData(t.attr),(s instanceof n.Model||s instanceof n.Collection)&&(r=s,s=s.toJSON()),this.setters[t.type]&&(i.isFunction(t.parse)&&(s=t.parse.call(t,s,t.key,this.view)),this.setters[t.type](t.$el,s,t.key))},this)},setters:{text:function(t,e){t.text()!=e&&t.text(i.isUndefined(e)?"":e)},html:function(t,e){t.html()!=e&&t.html(i.isUndefined(e)?"":e)},value:function(t,e){t.val()!=e&&t.val(i.isUndefined(e)?"":e)},attr:function(t,e,i){i&&t.attr(i,e)},prop:function(t,e,i){i&&t.prop(i,e)},style:function(t,e,i){i?t.css(i,e):t.css(e||{})},"class":function(t,e,i){t[e?"addClass":"removeClass"](i)},checked:function(t,e){t.attr("checked",e)},enabled:function(t,e){t.attr("disabled",!e)},disabled:function(t,e){t.attr("disabled",e)},toggle:function(t,e){t.toggle(e)},visible:function(t,e){t.toggle(!!e)},hidden:function(t,e){t.toggle(!e)}},getters:{text:function(t){return t.text()},html:function(t){return t.html()},value:function(t){return t.val()},checked:function(t){return t.prop("checked")}},getData:function(t){var e=[];return i.each(this.models,function(i){var n=i.get(t);-1==e.indexOf(n)&&e.push(n)}),2>e.length?e[0]:"-"},setData:function(t,e){i.invoke(this.models,"set",t,e)},inputEventHandler:function(t){return},changeEventHandler:function(t){if(t.data&&t.data.binding&&t.data.binding.$el.is(t.currentTarget)){var e=t.data.binding;this.getters[e.type]&&this.setData(e.attr,this.getters[e.type](e.$el,t))}},modelChangeHandler:function(t,e){i(t.changed).chain().keys().each(function(t){this.updateView(t,e)},this)}}),t}()}(this,jQuery,_,Backbone);